<!DOCTYPE html>
<html>
<head>
    <title>API Documentation - Page2API</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui.css">
    <style>
        .swagger-ui .topbar {
            display: none;
        }
        
        .swagger-ui {
            margin: 20px auto;
            max-width: 1460px;
        }
        
        .api-key-section {
            max-width: 1460px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .api-key-section h2 {
            margin-top: 0;
        }
        
        .api-keys-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .api-keys-table th,
        .api-keys-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .api-keys-table th {
            background: #f5f5f5;
        }
        
        .create-key-form {
            margin-top: 20px;
        }
        
        .create-key-form input[type="text"] {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        
        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #0071e3;
            color: white;
            cursor: pointer;
        }
        
        .button:hover {
            background: #0077ED;
        }
        
        .button.delete {
            background: #dc3545;
        }
        
        .button.delete:hover {
            background: #c82333;
        }
        
        /* Modal styles */
        .api-key-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            z-index: 1001;
            width: 90%;
            max-width: 500px;
        }

        .api-key-modal.visible {
            display: block;
        }

        .api-key-modal h3 {
            margin: 0 0 16px 0;
            font-size: 18px;
            color: #1d1d1f;
        }

        .api-key-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f5f5f7;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .copy-button {
            padding: 8px 16px;
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .copy-button:hover {
            background: #0077ED;
        }

        .copy-button.copied {
            background: #34c759;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal-overlay.visible {
            display: block;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .modal-button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-button.primary {
            background: #0071e3;
            color: white;
        }

        .modal-button.secondary {
            background: #e8e8ed;
            color: #1d1d1f;
        }

        /* Documentation styles */
        .documentation {
            max-width: 1460px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .documentation h2 {
            color: #1d1d1f;
            margin-bottom: 24px;
        }

        .documentation h3 {
            color: #1d1d1f;
            margin: 32px 0 16px;
        }

        .documentation p {
            color: #424245;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .documentation code {
            background: #f5f5f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 14px;
        }

        .documentation pre {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
        }

        .documentation pre code {
            background: none;
            padding: 0;
        }

        .documentation ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .documentation li {
            margin-bottom: 8px;
            color: #424245;
            line-height: 1.6;
        }

        /* Custom request editor */
        .swagger-ui .try-out__btn {
            display: none !important;
        }

        .swagger-ui .opblock .opblock-summary-description {
            text-align: right;
            padding-right: 16px;
        }

        .request-editor {
            margin: 16px 0;
        }

        .request-editor textarea {
            width: 100%;
            min-height: 200px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            padding: 12px;
            border: 1px solid #eee;
            border-radius: 4px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="api-key-section">
        <h2>API Keys</h2>
        <div class="create-key-form">
            <input type="text" id="keyName" placeholder="Key name (e.g., Production, Testing)">
            <button class="button" onclick="createApiKey()">Create New API Key</button>
        </div>
        <table class="api-keys-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created</th>
                    <th>Last Used</th>
                    <th>Status</th>
                    <th>Requests (1h)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="apiKeysTableBody">
                <!-- API keys will be loaded here -->
            </tbody>
        </table>
    </div>

    <div id="swagger-ui"></div>

    <div class="documentation">
        <h2>Comprehensive Documentation</h2>
        
        <h3>Introduction</h3>
        <p>The Page2API Travel Content API allows you to convert any travel product content into structured data for seamless distribution. This API is designed for both travel suppliers and distributors to standardize and exchange travel product information efficiently.</p>

        <h3>Authentication</h3>
        <p>All API requests require an API key to be included in the header:</p>
        <pre><code>X-API-Key: your_api_key_here</code></pre>
        <p>You can generate API keys in the section above. Each key has an hourly rate limit that resets automatically.</p>

        <h3>Making Requests</h3>
        <p>The main endpoint for content conversion is <code>/api/v1/convert</code>. Here's what you need to include in your request:</p>
        <ul>
            <li><strong>query</strong>: A natural language description of what you're looking for (e.g., "all tours and activities products")</li>
            <li><strong>format_url</strong>: URL of a page showing your desired response format</li>
            <li><strong>distributor_id</strong>: Your unique distributor ID for affiliate tracking</li>
        </ul>

        <h3>Example Request</h3>
        <pre><code>{
    "query": "all tours and activities products",
    "format_url": "https://example.com/format",
    "distributor_id": "DIST123"
}</code></pre>

        <h3>Response Format</h3>
        <p>The API returns a job ID immediately and processes your request asynchronously:</p>
        <pre><code>{
    "job_id": "job_xyz123",
    "status": "processing",
    "estimated_time": "30 seconds"
}</code></pre>

        <h3>Error Handling</h3>
        <p>The API uses standard HTTP status codes and returns detailed error messages:</p>
        <ul>
            <li><strong>400</strong>: Invalid request parameters</li>
            <li><strong>401</strong>: Invalid or missing API key</li>
            <li><strong>429</strong>: Rate limit exceeded</li>
            <li><strong>500</strong>: Server error</li>
        </ul>

        <h3>Rate Limiting</h3>
        <p>Each API key has a rate limit of 100 requests per hour by default. The current usage is displayed in the API keys table above. Rate limits reset automatically every hour.</p>

        <h3>Best Practices</h3>
        <ul>
            <li>Cache responses when possible to avoid unnecessary API calls</li>
            <li>Use specific queries to get more accurate results</li>
            <li>Monitor your rate limit usage</li>
            <li>Include error handling in your integration</li>
        </ul>
    </div>

    <!-- New API Key Modal -->
    <div class="modal-overlay" id="apiKeyModal">
        <div class="api-key-modal">
            <h3>Your New API Key</h3>
            <p>Please save this key as it won't be shown again.</p>
            <div class="api-key-display">
                <span id="newApiKey"></span>
                <button class="copy-button" onclick="copyApiKey()">
                    Copy
                </button>
            </div>
            <div class="modal-buttons">
                <button class="modal-button primary" onclick="closeApiKeyModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- OpenAPI Spec Data -->
    <script type="text/javascript">
        window.openApiSpec = JSON.parse({{ openapi_spec|tojson|safe }});
    </script>

    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui-bundle.js"></script>
    <script>
        // Initialize Swagger UI
        window.onload = function() {
            const ui = SwaggerUIBundle({
                spec: window.openApiSpec,
                dom_id: '#swagger-ui',
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "BaseLayout",
                requestInterceptor: function(req) {
                    // Add custom request editor
                    const opBlock = document.querySelector('.opblock-body');
                    if (opBlock && !opBlock.querySelector('.request-editor')) {
                        const editor = document.createElement('div');
                        editor.className = 'request-editor';
                        const textarea = document.createElement('textarea');
                        textarea.value = JSON.stringify(req.body, null, 2);
                        textarea.onchange = function(e) {
                            try {
                                req.body = JSON.parse(e.target.value);
                            } catch (err) {
                                console.error('Invalid JSON');
                            }
                        };
                        editor.appendChild(textarea);
                        opBlock.insertBefore(editor, opBlock.firstChild);
                    }
                    return req;
                }
            });
            
            // Load API keys
            loadApiKeys();
        }
        
        // Load API keys
        async function loadApiKeys() {
            try {
                const response = await fetch('/api/keys');
                const keys = await response.json();
                
                const tbody = document.getElementById('apiKeysTableBody');
                tbody.innerHTML = '';
                
                keys.forEach(key => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${key.name}</td>
                        <td>${new Date(key.created_at).toLocaleString()}</td>
                        <td>${key.last_used_at ? new Date(key.last_used_at).toLocaleString() : 'Never'}</td>
                        <td>${key.is_active ? 'Active' : 'Inactive'}</td>
                        <td>${key.requests_count}</td>
                        <td>
                            <button class="button delete" onclick="deleteApiKey(${key.id})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) {
                console.error('Error loading API keys:', error);
            }
        }
        
        // Create API key
        async function createApiKey() {
            const keyName = document.getElementById('keyName').value;
            if (!keyName) {
                alert('Please enter a key name');
                return;
            }
            
            try {
                const response = await fetch('/api/keys', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name: keyName })
                });
                
                const result = await response.json();
                if (result.key) {
                    document.getElementById('newApiKey').textContent = result.key;
                    document.getElementById('apiKeyModal').classList.add('visible');
                    document.querySelector('.api-key-modal').classList.add('visible');
                    document.getElementById('keyName').value = '';
                    loadApiKeys();
                }
            } catch (error) {
                console.error('Error creating API key:', error);
                alert('Error creating API key');
            }
        }
        
        // Delete API key
        async function deleteApiKey(keyId) {
            if (!confirm('Are you sure you want to delete this API key?')) {
                return;
            }
            
            try {
                await fetch(`/api/keys/${keyId}`, {
                    method: 'DELETE'
                });
                loadApiKeys();
            } catch (error) {
                console.error('Error deleting API key:', error);
                alert('Error deleting API key');
            }
        }
        
        // Copy API key
        async function copyApiKey() {
            const keyText = document.getElementById('newApiKey').textContent;
            try {
                await navigator.clipboard.writeText(keyText);
                const copyButton = document.querySelector('.copy-button');
                copyButton.textContent = 'Copied!';
                copyButton.classList.add('copied');
                setTimeout(() => {
                    copyButton.textContent = 'Copy';
                    copyButton.classList.remove('copied');
                }, 2000);
            } catch (error) {
                console.error('Error copying API key:', error);
                alert('Error copying API key');
            }
        }
        
        // Close API key modal
        function closeApiKeyModal() {
            document.getElementById('apiKeyModal').classList.remove('visible');
            document.querySelector('.api-key-modal').classList.remove('visible');
        }
    </script>
</body>
</html> 
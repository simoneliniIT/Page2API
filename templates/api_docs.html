<!DOCTYPE html>
<html>
<head>
    <title>API Documentation - Page2API</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui.css">
    <style>
        .swagger-ui .topbar {
            display: none;
        }
        
        .swagger-ui {
            margin: 20px auto;
            max-width: 1460px;
        }
        
        .api-key-section {
            max-width: 1460px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .api-key-section h2 {
            margin-top: 0;
        }
        
        .api-keys-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .api-keys-table th,
        .api-keys-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .api-keys-table th {
            background: #f5f5f5;
        }
        
        .create-key-form {
            margin-top: 20px;
        }
        
        .create-key-form input[type="text"] {
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 300px;
        }
        
        .button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background: #0071e3;
            color: white;
            cursor: pointer;
        }
        
        .button:hover {
            background: #0077ED;
        }
        
        .button.delete {
            background: #dc3545;
        }
        
        .button.delete:hover {
            background: #c82333;
        }
        
        /* Modal styles */
        .api-key-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 8px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.15);
            z-index: 1001;
            width: 90%;
            max-width: 500px;
        }

        .api-key-modal.visible {
            display: block;
        }

        .api-key-modal h3 {
            margin: 0 0 16px 0;
            font-size: 18px;
            color: #1d1d1f;
        }

        .api-key-display {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f5f5f7;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 14px;
            word-break: break-all;
        }

        .copy-button {
            padding: 8px 16px;
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
            white-space: nowrap;
        }

        .copy-button:hover {
            background: #0077ED;
        }

        .copy-button.copied {
            background: #34c759;
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
        }

        .modal-overlay.visible {
            display: block;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .modal-button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-button.primary {
            background: #0071e3;
            color: white;
        }

        .modal-button.secondary {
            background: #e8e8ed;
            color: #1d1d1f;
        }

        /* Documentation styles */
        .documentation {
            max-width: 1460px;
            margin: 40px auto;
            padding: 20px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .documentation h2 {
            color: #1d1d1f;
            margin-bottom: 24px;
        }

        .documentation h3 {
            color: #1d1d1f;
            margin: 32px 0 16px;
        }

        .documentation p {
            color: #424245;
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .documentation code {
            background: #f5f5f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 14px;
        }

        .documentation pre {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 16px 0;
        }

        .documentation pre code {
            background: none;
            padding: 0;
        }

        .documentation ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .documentation li {
            margin-bottom: 8px;
            color: #424245;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- API Key Management Section -->
    <div class="api-key-section">
        <h2>API Keys</h2>
        <div class="create-key-form">
            <input type="text" id="keyName" placeholder="Key name (e.g., Production, Testing)">
            <button class="button" onclick="createApiKey()">Create New API Key</button>
        </div>
        <table class="api-keys-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created</th>
                    <th>Last Used</th>
                    <th>Status</th>
                    <th>Requests (1h)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="apiKeysTableBody">
                <!-- API keys will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- Modal for displaying new API key -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="api-key-modal" id="apiKeyModal">
            <h3>Your New API Key</h3>
            <p>Please copy your API key now. You won't be able to see it again!</p>
            <div class="api-key-display">
                <span id="newApiKey"></span>
                <button class="copy-button" onclick="copyApiKey()">Copy</button>
            </div>
            <div class="modal-buttons">
                <button class="modal-button primary" onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Swagger UI Section -->
    <div id="swagger-ui"></div>

    <!-- Documentation Section -->
    <div class="documentation">
        <h2>Comprehensive Documentation</h2>

        <h3>Introduction</h3>
        <p>The Page2API Travel Content API allows you to convert any travel product content into structured data for seamless distribution. This API is designed for both travel suppliers and distributors to standardize and exchange travel product information efficiently.</p>

        <h3>Authentication</h3>
        <p>All API requests require an API key to be included in the request headers. To authenticate your requests, include your API key in the <code>X-API-Key</code> header:</p>
        <pre><code>X-API-Key: your_api_key_here</code></pre>

        <h3>Rate Limiting</h3>
        <p>API requests are rate-limited based on your account tier. The default rate limit is 100 requests per hour. You can view your current rate limit and usage in the API Keys table above.</p>

        <h3>Error Handling</h3>
        <p>The API uses standard HTTP response codes to indicate success or failure:</p>
        <ul>
            <li><code>200 OK</code> - Request successful</li>
            <li><code>202 Accepted</code> - Request accepted for processing</li>
            <li><code>400 Bad Request</code> - Invalid request parameters</li>
            <li><code>401 Unauthorized</code> - Invalid or missing API key</li>
            <li><code>404 Not Found</code> - Resource not found</li>
            <li><code>429 Too Many Requests</code> - Rate limit exceeded</li>
            <li><code>500 Internal Server Error</code> - Server error</li>
        </ul>

        <h3>Example Usage</h3>
        <p>Here's an example of how to convert travel products using the API:</p>
        <pre><code>curl -X POST https://page2api.com/api/v1/convert \
-H "X-API-Key: your_api_key_here" \
-H "Content-Type: application/json" \
-d '{
    "query": "walking tours in Rome under $100",
    "format_url": "https://example.com/product-format.json",
    "distributor_id": "your_distributor_id"
}'</code></pre>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui-bundle.js"></script>
    
    <!-- Store OpenAPI spec -->
    <script type="application/json" id="openapi-spec">
        {{ openapi_spec|tojson|safe }}
    </script>
    
    <script>
        // Initialize Swagger UI
        window.onload = function() {
            // Parse OpenAPI spec from the script tag
            const openApiSpec = JSON.parse(document.getElementById('openapi-spec').textContent);
            
            const ui = SwaggerUI({
                dom_id: '#swagger-ui',
                spec: openApiSpec,
                deepLinking: true,
                presets: [
                    SwaggerUI.presets.apis,
                    SwaggerUI.SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUI.plugins.DownloadUrl
                ],
                layout: "BaseLayout"
            });
        }

        // API Key Management Functions
        function loadApiKeys() {
            fetch('/api/keys')
                .then(response => response.json())
                .then(keys => {
                    const tbody = document.getElementById('apiKeysTableBody');
                    tbody.innerHTML = '';
                    keys.forEach(key => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${key.name}</td>
                            <td>${new Date(key.created_at).toLocaleString()}</td>
                            <td>${key.last_used_at ? new Date(key.last_used_at).toLocaleString() : 'Never'}</td>
                            <td>${key.is_active ? 'Active' : 'Inactive'}</td>
                            <td>${key.requests_count}</td>
                            <td>
                                <button class="button delete" onclick="deleteApiKey(${key.id})">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(error => console.error('Error loading API keys:', error));
        }

        function createApiKey() {
            const name = document.getElementById('keyName').value;
            if (!name) {
                alert('Please enter a name for the API key');
                return;
            }

            fetch('/api/keys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('newApiKey').textContent = data.key;
                document.getElementById('modalOverlay').classList.add('visible');
                document.getElementById('apiKeyModal').classList.add('visible');
                document.getElementById('keyName').value = '';
                loadApiKeys();
            })
            .catch(error => console.error('Error creating API key:', error));
        }

        function deleteApiKey(keyId) {
            if (!confirm('Are you sure you want to delete this API key?')) {
                return;
            }

            fetch(`/api/keys/${keyId}`, {
                method: 'DELETE'
            })
            .then(() => loadApiKeys())
            .catch(error => console.error('Error deleting API key:', error));
        }

        function copyApiKey() {
            const apiKey = document.getElementById('newApiKey').textContent;
            navigator.clipboard.writeText(apiKey)
                .then(() => {
                    const button = document.querySelector('.copy-button');
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    setTimeout(() => {
                        button.textContent = 'Copy';
                        button.classList.remove('copied');
                    }, 2000);
                })
                .catch(error => console.error('Error copying API key:', error));
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('visible');
            document.getElementById('apiKeyModal').classList.remove('visible');
        }

        // Load API keys when the page loads
        document.addEventListener('DOMContentLoaded', loadApiKeys);
    </script>
</body>
</html> 
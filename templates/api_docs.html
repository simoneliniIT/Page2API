<!DOCTYPE html>
<html>
<head>
    <title>API Documentation - Page2API</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        body {
            background-color: #f5f5f7;
            color: #1d1d1f;
            line-height: 1.5;
            padding-bottom: 40px;
        }

        /* User Info Styles */
        .user-info {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-details {
            text-align: right;
        }

        .user-name {
            font-size: 14px;
            color: #1d1d1f;
            display: block;
        }

        .user-role {
            font-size: 12px;
            color: #86868b;
            display: block;
            margin-top: 2px;
            text-transform: capitalize;
        }

        .logout-button {
            background-color: #e8e8ed;
            color: #1d1d1f;
            border: none;
            padding: 8px 16px;
            border-radius: 980px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .logout-button:hover {
            background-color: #d8d8d8;
        }

        /* API Key Section Styles */
        .api-key-section {
            max-width: 1460px;
            margin: 20px auto;
            padding: 24px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }

        .api-key-section h2 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #1d1d1f;
        }

        .api-keys-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
        }

        .api-keys-table th,
        .api-keys-table td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid #e8e8ed;
        }

        .api-keys-table th {
            background: #f5f5f7;
            font-weight: 500;
            color: #1d1d1f;
            font-size: 14px;
        }

        .api-keys-table td {
            font-size: 14px;
            color: #1d1d1f;
        }

        /* Create Key Form Styles */
        .create-key-form {
            margin-top: 24px;
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .create-key-form input[type="text"] {
            padding: 12px;
            border: 1px solid #d2d2d7;
            border-radius: 12px;
            font-size: 14px;
            width: 300px;
            transition: all 0.2s ease;
        }

        .create-key-form input[type="text"]:focus {
            outline: none;
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        /* Button Styles */
        .button {
            background-color: #0071e3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 980px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .button:hover {
            background-color: #0077ED;
            transform: scale(1.02);
        }

        .button.delete {
            background-color: #ff3b30;
        }

        .button.delete:hover {
            background-color: #ff453a;
        }

        /* Swagger UI Customization */
        .swagger-ui {
            margin: 20px auto;
            max-width: 1460px;
            padding: 24px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }

        .swagger-ui .topbar {
            display: none;
        }

        .swagger-ui .info {
            margin: 20px 0;
        }

        .swagger-ui .info .title {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            font-size: 24px;
            font-weight: 500;
            color: #1d1d1f;
        }

        .swagger-ui .opblock {
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
            border: 1px solid #e8e8ed;
            margin: 0 0 16px;
        }

        .swagger-ui .opblock .opblock-summary {
            padding: 16px;
        }

        .swagger-ui .opblock .opblock-summary-method {
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            min-width: 80px;
            text-align: center;
        }

        .swagger-ui .opblock-description-wrapper p {
            font-size: 14px;
            color: #1d1d1f;
            line-height: 1.5;
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .api-key-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 24px;
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            width: 90%;
            max-width: 500px;
        }

        .api-key-modal.visible,
        .modal-overlay.visible {
            display: block;
        }

        .api-key-modal h3 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #1d1d1f;
        }

        .api-key-display {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 12px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 14px;
            word-break: break-all;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Documentation Section */
        .documentation {
            max-width: 1460px;
            margin: 20px auto;
            padding: 24px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02);
        }

        .documentation h2 {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 24px;
            color: #1d1d1f;
        }

        .documentation h3 {
            font-size: 18px;
            font-weight: 500;
            margin: 32px 0 16px;
            color: #1d1d1f;
        }

        .documentation p {
            font-size: 14px;
            line-height: 1.6;
            color: #1d1d1f;
            margin-bottom: 16px;
        }

        .documentation code {
            background: #f5f5f7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 13px;
            color: #1d1d1f;
        }

        .documentation pre {
            background: #f5f5f7;
            padding: 16px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 16px 0;
            font-family: ui-monospace, "SF Mono", Monaco, monospace;
            font-size: 13px;
            line-height: 1.6;
        }

        .documentation ul {
            margin: 16px 0;
            padding-left: 24px;
        }

        .documentation li {
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.6;
            color: #1d1d1f;
        }

        /* Navigation */
        .nav-buttons {
            max-width: 1460px;
            margin: 20px auto;
            padding: 0 24px;
            display: flex;
            gap: 16px;
        }
    </style>
</head>
<body>
    <!-- User Info -->
    <div class="user-info">
        <div class="user-details">
            <span class="user-name">{{ current_user.first_name }} {{ current_user.last_name }}</span>
            <span class="user-role">{{ current_user.user_type }}</span>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-button">Log Out</a>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <a href="{{ url_for('consumer') }}" class="button">Back to Consumer Dashboard</a>
    </div>

    <!-- API Key Management Section -->
    <div class="api-key-section">
        <h2>API Keys</h2>
        <div class="create-key-form">
            <input type="text" id="keyName" placeholder="Key name (e.g., Production, Testing)">
            <button class="button" onclick="createApiKey()">Create New API Key</button>
        </div>
        <table class="api-keys-table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Created</th>
                    <th>Last Used</th>
                    <th>Status</th>
                    <th>Requests (1h)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="apiKeysTableBody">
                <!-- API keys will be loaded here -->
            </tbody>
        </table>
    </div>

    <!-- Swagger UI Section -->
    <div id="swagger-ui" data-spec='{{ openapi_spec|tojson|safe }}'></div>

    <!-- Documentation Section -->
    <div class="documentation">
        <h2>Getting Started</h2>

        <h3>Authentication</h3>
        <p>All API requests require an API key to be included in the request headers:</p>
        <pre><code>X-API-Key: your_api_key_here</code></pre>

        <h3>Rate Limiting</h3>
        <p>API requests are rate-limited based on your account tier. The default rate limit is 100 requests per hour per API key.</p>

        <h3>Making Requests</h3>
        <p>To convert travel products, send a POST request to the conversion endpoint with your query and format specification:</p>
        <pre><code>curl -X POST https://page2api.onrender.com/api/v1/convert \
-H "X-API-Key: your_api_key_here" \
-H "Content-Type: application/json" \
-d '{
    "query": "walking tours in Rome",
    "format_url": "https://example.com/format.json",
    "distributor_id": "your_distributor_id"
}'</code></pre>

        <h3>Format Specification</h3>
        <p>The format specification should be a JSON Schema document that defines the structure of your desired output. Example:</p>
        <pre><code>{
  "type": "object",
  "required": ["name", "description", "price"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Name of the tour"
    },
    "description": {
      "type": "string",
      "description": "Full description"
    },
    "price": {
      "type": "number",
      "description": "Price in USD"
    }
  }
}</code></pre>

        <h3>Error Handling</h3>
        <p>The API uses standard HTTP response codes to indicate success or failure:</p>
        <ul>
            <li><code>200 OK</code> - Request successful</li>
            <li><code>202 Accepted</code> - Request accepted for processing</li>
            <li><code>400 Bad Request</code> - Invalid request parameters</li>
            <li><code>401 Unauthorized</code> - Invalid or missing API key</li>
            <li><code>404 Not Found</code> - Resource not found</li>
            <li><code>429 Too Many Requests</code> - Rate limit exceeded</li>
            <li><code>500 Internal Server Error</code> - Server error</li>
        </ul>
    </div>

    <!-- Modal for displaying new API key -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="api-key-modal" id="apiKeyModal">
            <h3>Your New API Key</h3>
            <p>Please copy your API key now. You won't be able to see it again!</p>
            <div class="api-key-display">
                <span id="newApiKey"></span>
                <button class="button" onclick="copyApiKey()">Copy</button>
            </div>
            <div class="modal-buttons">
                <button class="button" onclick="closeModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui-bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.11.0/swagger-ui-standalone-preset.js"></script>
    
    <script>
        // Initialize Swagger UI
        window.onload = function() {
            // Get OpenAPI spec from data attribute
            const swaggerElement = document.getElementById('swagger-ui');
            const spec = JSON.parse(swaggerElement.getAttribute('data-spec'));
            
            // Initialize Swagger UI
            const ui = SwaggerUIBundle({
                dom_id: '#swagger-ui',
                spec: spec,
                deepLinking: true,
                presets: [
                    SwaggerUIBundle.presets.apis,
                    SwaggerUIBundle.SwaggerUIStandalonePreset
                ],
                plugins: [
                    SwaggerUIBundle.plugins.DownloadUrl
                ],
                layout: "BaseLayout",
                docExpansion: "list",
                defaultModelsExpandDepth: 1,
                defaultModelExpandDepth: 1,
                defaultModelRendering: 'model'
            });

            // Load API keys
            loadApiKeys();
        }

        // API Key Management Functions
        function loadApiKeys() {
            fetch('/api/keys')
                .then(response => response.json())
                .then(keys => {
                    const tbody = document.getElementById('apiKeysTableBody');
                    tbody.innerHTML = '';
                    keys.forEach(key => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${key.name}</td>
                            <td>${new Date(key.created_at).toLocaleString()}</td>
                            <td>${key.last_used_at ? new Date(key.last_used_at).toLocaleString() : 'Never'}</td>
                            <td>${key.is_active ? 'Active' : 'Inactive'}</td>
                            <td>${key.requests_count}</td>
                            <td>
                                <button class="button delete" onclick="deleteApiKey(${key.id})">Delete</button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                })
                .catch(error => console.error('Error loading API keys:', error));
        }

        function createApiKey() {
            const name = document.getElementById('keyName').value;
            if (!name) {
                alert('Please enter a name for the API key');
                return;
            }

            fetch('/api/keys', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('newApiKey').textContent = data.key;
                document.getElementById('modalOverlay').classList.add('visible');
                document.getElementById('apiKeyModal').classList.add('visible');
                document.getElementById('keyName').value = '';
                loadApiKeys();
            })
            .catch(error => console.error('Error creating API key:', error));
        }

        function deleteApiKey(keyId) {
            if (!confirm('Are you sure you want to delete this API key?')) {
                return;
            }

            fetch(`/api/keys/${keyId}`, {
                method: 'DELETE'
            })
            .then(() => loadApiKeys())
            .catch(error => console.error('Error deleting API key:', error));
        }

        function copyApiKey() {
            const apiKey = document.getElementById('newApiKey').textContent;
            navigator.clipboard.writeText(apiKey)
                .then(() => {
                    const button = document.querySelector('.api-key-display .button');
                    button.textContent = 'Copied!';
                    setTimeout(() => {
                        button.textContent = 'Copy';
                    }, 2000);
                })
                .catch(error => console.error('Error copying API key:', error));
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('visible');
            document.getElementById('apiKeyModal').classList.remove('visible');
        }
    </script>
</body>
</html> 